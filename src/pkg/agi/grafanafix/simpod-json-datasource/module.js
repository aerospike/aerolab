define(["@emotion/css","@grafana/data","@grafana/runtime","@grafana/ui","lodash","react","rxjs"],((e,t,r,n,a,i,s)=>(()=>{"use strict";var o={89:t=>{t.exports=e},781:e=>{e.exports=t},531:e=>{e.exports=r},7:e=>{e.exports=n},241:e=>{e.exports=a},959:e=>{e.exports=i},269:e=>{e.exports=s}},l={};function c(e){var t=l[e];if(void 0!==t)return t.exports;var r=l[e]={exports:{}};return o[e](r,r.exports,c),r.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var r in t)c.o(t,r)&&!c.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},c.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var u={};c.r(u),c.d(u,{plugin:()=>na});var d=c(781),p=c(7),h=c(959),f=c.n(h),m=c(89);function y(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const v=[{label:"Builder",value:"builder",component:()=>f().createElement(p.Tag,{className:(0,m.css)({fontSize:10,padding:"1px 5px",marginLeft:"5px",verticalAlign:"text-bottom"}),name:"Experimental",colorIndex:1})},{label:"Code",value:"code"}];function g(e){var t,r,{mode:n}=e,a=function(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}(e,["mode"]);return f().createElement("div",{"data-testid":"QueryEditorModeToggle"},f().createElement(p.RadioButtonGroup,(t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){y(e,t,r[t])}))}return e}({size:"sm"},a),r=null!=(r={options:v,value:n})?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t.push.apply(t,r)}return t}(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})),t)))}function _(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_(e,t,r[t])}))}return e}function w(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t.push.apply(t,r)}return t}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const O=({children:e})=>{const t=(0,p.useStyles2)(x);return f().createElement("div",{className:t.root},e)},x=e=>({root:(0,m.css)({display:"flex",flexWrap:"wrap",alignItems:"center",gap:e.spacing(3),minHeight:e.spacing(4)})});var k=Object.getOwnPropertySymbols,S=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;const E=e=>{var t=e,{children:r}=t,n=((e,t)=>{var r={};for(var n in e)S.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&k)for(var n of k(e))t.indexOf(n)<0&&j.call(e,n)&&(r[n]=e[n]);return r})(t,["children"]);const a=(0,p.useStyles2)((0,h.useCallback)((e=>T(e,n)),[n]));return f().createElement("div",{className:a.root},r)},T=(e,t)=>{var r,n,a;return{root:(0,m.css)({display:"flex",flexDirection:null!=(r=t.direction)?r:"row",flexWrap:null==(n=t.wrap)||n?"wrap":void 0,alignItems:t.alignItems,gap:e.spacing(null!=(a=t.gap)?a:2),flexGrow:t.flexGrow})}},P=({children:e})=>f().createElement(E,{gap:.5,direction:"column"},e),C=({children:e})=>f().createElement(E,{gap:1},e),N=({v:e=0,h:t=0,layout:r="block"})=>{const n=(0,p.useStyles2)((0,h.useCallback)((n=>Z(n,{v:e,h:t,layout:r})),[e,t,r]));return f().createElement("span",{className:(0,m.cx)(n.wrapper)})},Z=(e,t)=>{var r,n;return{wrapper:(0,m.css)([{paddingRight:e.spacing(null!=(r=t.h)?r:0),paddingBottom:e.spacing(null!=(n=t.v)?n:0)},"inline"===t.layout&&{display:"inline-block"},"block"===t.layout&&{display:"block"}])}};var R=Object.defineProperty,z=Object.getOwnPropertySymbols,I=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable,M=(e,t,r)=>t in e?R(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const D=e=>{var t;const r=e,{label:n,optional:a,tooltip:i,tooltipInteractive:s,children:o,width:l}=r,c=((e,t)=>{var r={};for(var n in e)I.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&z)for(var n of z(e))t.indexOf(n)<0&&A.call(e,n)&&(r[n]=e[n]);return r})(r,["label","optional","tooltip","tooltipInteractive","children","width"]),u=(0,p.useStyles2)((0,h.useCallback)((e=>$(e,l)),[l])),d=(null==c?void 0:c.htmlFor)||(null==(t=p.ReactUtils)?void 0:t.getChildId(o)),m=f().createElement(f().Fragment,null,f().createElement("label",{className:u.label,htmlFor:d},n,a&&f().createElement("span",{className:u.optional}," - optional"),i&&f().createElement(p.Tooltip,{placement:"top",content:i,theme:"info",interactive:s},f().createElement(p.Icon,{tabIndex:0,name:"info-circle",size:"sm",className:u.icon}))),f().createElement(N,{v:.5}));return f().createElement("div",{className:u.root},f().createElement(p.Field,((e,t)=>{for(var r in t||(t={}))I.call(t,r)&&M(e,r,t[r]);if(z)for(var r of z(t))A.call(t,r)&&M(e,r,t[r]);return e})({className:u.field,label:m},c),o))},$=(e,t)=>({root:(0,m.css)({minWidth:e.spacing(null!=t?t:0)}),label:(0,m.css)({fontSize:12,fontWeight:e.typography.fontWeightMedium}),optional:(0,m.css)({fontStyle:"italic",color:e.colors.text.secondary}),field:(0,m.css)({marginBottom:0}),icon:(0,m.css)({color:e.colors.text.secondary,marginLeft:e.spacing(1),":hover":{color:e.colors.text.primary}})});let L;L="undefined"!=typeof window?window:"undefined"!=typeof self?self:c.g;let F=null,V=null;const W=L.clearTimeout,q=L.setTimeout,B=L.cancelAnimationFrame||L.mozCancelAnimationFrame||L.webkitCancelAnimationFrame,U=L.requestAnimationFrame||L.mozRequestAnimationFrame||L.webkitRequestAnimationFrame;null==B||null==U?(F=W,V=function(e){return q(e,20)}):(F=function([e,t]){B(e),W(t)},V=function(e){const t=U((function(){W(r),e()})),r=q((function(){B(t),e()}),20);return[t,r]});class K extends h.Component{constructor(...e){super(...e),this.state={height:this.props.defaultHeight||0,scaledHeight:this.props.defaultHeight||0,scaledWidth:this.props.defaultWidth||0,width:this.props.defaultWidth||0},this._autoSizer=null,this._detectElementResize=null,this._parentNode=null,this._resizeObserver=null,this._timeoutId=null,this._onResize=()=>{this._timeoutId=null;const{disableHeight:e,disableWidth:t,onResize:r}=this.props;if(this._parentNode){const n=window.getComputedStyle(this._parentNode)||{},a=parseFloat(n.paddingLeft||"0"),i=parseFloat(n.paddingRight||"0"),s=parseFloat(n.paddingTop||"0"),o=parseFloat(n.paddingBottom||"0"),l=this._parentNode.getBoundingClientRect(),c=l.height-s-o,u=l.width-a-i,d=this._parentNode.offsetHeight-s-o,p=this._parentNode.offsetWidth-a-i;(e||this.state.height===d&&this.state.scaledHeight===c)&&(t||this.state.width===p&&this.state.scaledWidth===u)||(this.setState({height:d,width:p,scaledHeight:c,scaledWidth:u}),"function"==typeof r&&r({height:d,scaledHeight:c,scaledWidth:u,width:p}))}},this._setRef=e=>{this._autoSizer=e}}componentDidMount(){const{nonce:e}=this.props,t=this._autoSizer?this._autoSizer.parentNode:null;if(null!=t&&t.ownerDocument&&t.ownerDocument.defaultView&&t instanceof t.ownerDocument.defaultView.HTMLElement){this._parentNode=t;const r=t.ownerDocument.defaultView.ResizeObserver;null!=r?(this._resizeObserver=new r((()=>{this._timeoutId=setTimeout(this._onResize,0)})),this._resizeObserver.observe(t)):(this._detectElementResize=function(e){let t,r,n,a,i,s,o;const l="undefined"!=typeof document&&document.attachEvent;if(!l){s=function(e){const t=e.__resizeTriggers__,r=t.firstElementChild,n=t.lastElementChild,a=r.firstElementChild;n.scrollLeft=n.scrollWidth,n.scrollTop=n.scrollHeight,a.style.width=r.offsetWidth+1+"px",a.style.height=r.offsetHeight+1+"px",r.scrollLeft=r.scrollWidth,r.scrollTop=r.scrollHeight},i=function(e){return e.offsetWidth!==e.__resizeLast__.width||e.offsetHeight!==e.__resizeLast__.height},o=function(e){if(e.target.className&&"function"==typeof e.target.className.indexOf&&e.target.className.indexOf("contract-trigger")<0&&e.target.className.indexOf("expand-trigger")<0)return;const t=this;s(this),this.__resizeRAF__&&F(this.__resizeRAF__),this.__resizeRAF__=V((function(){i(t)&&(t.__resizeLast__.width=t.offsetWidth,t.__resizeLast__.height=t.offsetHeight,t.__resizeListeners__.forEach((function(r){r.call(t,e)})))}))};let e=!1,l="";n="animationstart";const c="Webkit Moz O ms".split(" ");let u="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),d="";{const t=document.createElement("fakeelement");if(void 0!==t.style.animationName&&(e=!0),!1===e)for(let r=0;r<c.length;r++)if(void 0!==t.style[c[r]+"AnimationName"]){d=c[r],l="-"+d.toLowerCase()+"-",n=u[r],e=!0;break}}r="resizeanim",t="@"+l+"keyframes "+r+" { from { opacity: 0; } to { opacity: 0; } } ",a=l+"animation: 1ms "+r+"; "}return{addResizeListener:function(i,c){if(l)i.attachEvent("onresize",c);else{if(!i.__resizeTriggers__){const l=i.ownerDocument,c=L.getComputedStyle(i);c&&"static"===c.position&&(i.style.position="relative"),function(r){if(!r.getElementById("detectElementResize")){const n=(t||"")+".resize-triggers { "+(a||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; z-index: -1; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',i=r.head||r.getElementsByTagName("head")[0],s=r.createElement("style");s.id="detectElementResize",s.type="text/css",null!=e&&s.setAttribute("nonce",e),s.styleSheet?s.styleSheet.cssText=n:s.appendChild(r.createTextNode(n)),i.appendChild(s)}}(l),i.__resizeLast__={},i.__resizeListeners__=[],(i.__resizeTriggers__=l.createElement("div")).className="resize-triggers";const u=l.createElement("div");u.className="expand-trigger",u.appendChild(l.createElement("div"));const d=l.createElement("div");d.className="contract-trigger",i.__resizeTriggers__.appendChild(u),i.__resizeTriggers__.appendChild(d),i.appendChild(i.__resizeTriggers__),s(i),i.addEventListener("scroll",o,!0),n&&(i.__resizeTriggers__.__animationListener__=function(e){e.animationName===r&&s(i)},i.__resizeTriggers__.addEventListener(n,i.__resizeTriggers__.__animationListener__))}i.__resizeListeners__.push(c)}},removeResizeListener:function(e,t){if(l)e.detachEvent("onresize",t);else if(e.__resizeListeners__.splice(e.__resizeListeners__.indexOf(t),1),!e.__resizeListeners__.length){e.removeEventListener("scroll",o,!0),e.__resizeTriggers__.__animationListener__&&(e.__resizeTriggers__.removeEventListener(n,e.__resizeTriggers__.__animationListener__),e.__resizeTriggers__.__animationListener__=null);try{e.__resizeTriggers__=!e.removeChild(e.__resizeTriggers__)}catch(e){}}}}}(e),this._detectElementResize.addResizeListener(t,this._onResize)),this._onResize()}}componentWillUnmount(){this._parentNode&&(this._detectElementResize&&this._detectElementResize.removeResizeListener(this._parentNode,this._onResize),null!==this._timeoutId&&clearTimeout(this._timeoutId),this._resizeObserver&&this._resizeObserver.disconnect())}render(){const{children:e,defaultHeight:t,defaultWidth:r,disableHeight:n=!1,disableWidth:a=!1,doNotBailOutOnEmptyChildren:i=!1,nonce:s,onResize:o,style:l={},tagName:c="div",...u}=this.props,{height:d,scaledHeight:p,scaledWidth:f,width:m}=this.state,y={overflow:"visible"},v={};let g=!1;return n||(0===d&&(g=!0),y.height=0,v.height=d,v.scaledHeight=p),a||(0===m&&(g=!0),y.width=0,v.width=m,v.scaledWidth=f),i&&(g=!1),(0,h.createElement)(c,{ref:this._setRef,style:{...y,...l},...u},!g&&e(v))}}var H=c(241);function J(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Q=({datasource:e,onChange:t,onRunQuery:r,query:n,payload:a})=>{const[i,s]=f().useState(),[o,l]=f().useState(null!=a?a:""),[c,u]=f().useState(null),[d,h]=f().useState([]),[m,y]=f().useState(!1),v=f().useCallback((()=>e.listMetrics("",void 0).then((e=>{const t=e.map((e=>({label:e.label,value:e.value}))),r=(0,H.find)(t,(e=>e.value===n.target));return s(void 0===r?{label:"",value:""}:r),t}),(e=>{throw s({label:"",value:""}),h([]),new Error(e.statusText)}))),[e,n.target]),g=f().useCallback((()=>{y(!0),v().then((e=>{h(e)})).finally((()=>{y(!1)}))}),[v,h,y]);return f().useEffect((()=>g()),[]),f().useEffect((()=>{var e,a;void 0!==(null==i?void 0:i.value)&&""!==(null==i?void 0:i.value)&&(null!==c&&(null==i?void 0:i.value)===c.metric&&o===c.payload||(u({payload:o,metric:i.value.toString()}),t((e=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){J(e,t,r[t])}))}return e}({},n),a=null!=(a={payload:o,target:i.value.toString()})?a:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t.push.apply(t,r)}return t}(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})),e)),r()))}),[o,i]),f().createElement(f().Fragment,null,f().createElement(p.InlineFieldRow,null,f().createElement(p.InlineField,null,f().createElement(p.Select,{isLoading:m,prefix:"Metric: ",options:d,placeholder:"Select metric",allowCustomValue:!0,value:i,onChange:e=>{s(e)}}))),f().createElement(p.InlineFieldRow,null,f().createElement(K,{disableHeight:!0},(({width:e})=>f().createElement("div",{style:{width:e+"px"}},f().createElement(p.InlineLabel,null,"Payload"),f().createElement(p.CodeEditor,{width:"100%",height:"200px",language:"json",showLineNumbers:!0,showMiniMap:o.length>100,value:o,onBlur:e=>l(e)}))))))},Y=(0,p.withTheme2)((({theme:e,onValueChange:t,value:r})=>{const n=(e=>{const t=function(e){return{outline:"2px dotted transparent",outlineOffset:"2px",boxShadow:`0 0 0 2px ${e.colors.background.canvas}, 0 0 0px 4px ${e.colors.primary.main}`,transitionTimingFunction:"cubic-bezier(0.19, 1, 0.22, 1)",transitionDuration:"0.2s",transitionProperty:"outline, outline-offset, box-shadow"}}(e);return{wrapper:m.css`
      &:focus-within {
        ${t}
      }
    `}})(e),a=f().useRef(void 0===r?"</div>":`<div>${r.replace(/([^\n])\n/g,"$1</div><div>").replace(/\n/g,"</div><div><br /></div><div>")}`);return f().createElement("div",{className:(0,m.cx)("slate-query-field__wrapper",n.wrapper)},f().createElement("div",{dangerouslySetInnerHTML:{__html:a.current},contentEditable:!0,style:{width:"100%",outline:"none"},onBlur:e=>{t(e.currentTarget.innerText.replace(/\n\n/g,"\n"))},onInput:e=>{a.current=e.currentTarget.innerHTML}}))}));function G(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const X=({config:e,datasource:t,query:r,onPayloadChange:n,isMulti:a,value:i})=>{const[s,o]=f().useState(),[l,c]=f().useState(!1),[u,d]=f().useState([]),h=f().useCallback((()=>{var n;return t.listMetricPayloadOptions(e.name,null!==(n=r.target)&&void 0!==n?n:"",r.payload).then((e=>{if(i){const a=t.getVariables();for(const t in a)Object.prototype.hasOwnProperty.call(a,t)&&e.push({label:`$${t}`,value:`$${t}`});if((0,H.isArray)(s))for(let t=0;t<s.length;t++)void 0!==e.find((e=>e.value===s[t].value))&&e.push({value:s[t].value,label:s[t].label});else s&&void 0!==e.find((e=>e.value===s.value))&&e.push((r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){G(e,t,r[t])}))}return e}({},s),n=null!=(n={value:s.value,label:s.label})?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(n)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t.push.apply(t,r)}return t}(Object(n)).forEach((function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(n,e))})),r))}var r,n;return e}),(e=>{throw d([]),new Error(e.statusText)}))}),[t,r.payload,r.target]),m=f().useCallback((()=>{c(!0),h().then((e=>{d(e)})).finally((()=>{c(!1)}))}),[h,d,c]);var y,v,g;return f().useEffect((()=>{i&&m()}),[]),f().useEffect((()=>{if(i)if((0,H.isArray)(i)){const e=u.filter((e=>(0,H.includes)(i,e.value)));e?o(e):i&&o([{label:i,value:i}])}else{const e=u.find((e=>e.value===i));e?o(e):i&&o({label:i.toString(),value:i})}else o(void 0)}),[r.payload,u]),f().createElement(p.Select,{key:e.name,width:e.width,isLoading:l,prefix:null!==(y=e.label)&&void 0!==y?y:e.name,options:null!==(v=e.options)&&void 0!==v?v:u,placeholder:null!==(g=e.placeholder)&&void 0!==g?g:"",allowCustomValue:!0,isClearable:!0,isMulti:a,value:s,onOpenMenu:()=>{e.options||m()},onChange:e=>{n(e)}})};var ee,te;!function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const r of e)t[r]=r;return t},e.getValidEnumValues=t=>{const r=e.objectKeys(t).filter((e=>"number"!=typeof t[t[e]])),n={};for(const e of r)n[e]=t[e];return e.objectValues(n)},e.objectValues=t=>e.objectKeys(t).map((function(e){return t[e]})),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(const r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map((e=>"string"==typeof e?`'${e}'`:e)).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(ee||(ee={})),function(e){e.mergeShapes=(e,t)=>({...e,...t})}(te||(te={}));const re=ee.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ne=e=>{switch(typeof e){case"undefined":return re.undefined;case"string":return re.string;case"number":return isNaN(e)?re.nan:re.number;case"boolean":return re.boolean;case"function":return re.function;case"bigint":return re.bigint;case"symbol":return re.symbol;case"object":return Array.isArray(e)?re.array:null===e?re.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?re.promise:"undefined"!=typeof Map&&e instanceof Map?re.map:"undefined"!=typeof Set&&e instanceof Set?re.set:"undefined"!=typeof Date&&e instanceof Date?re.date:re.object;default:return re.unknown}},ae=ee.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class ie extends Error{constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(e){return e.message},r={_errors:[]},n=e=>{for(const a of e.issues)if("invalid_union"===a.code)a.unionErrors.map(n);else if("invalid_return_type"===a.code)n(a.returnTypeError);else if("invalid_arguments"===a.code)n(a.argumentsError);else if(0===a.path.length)r._errors.push(t(a));else{let e=r,n=0;for(;n<a.path.length;){const r=a.path[n];n===a.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(a))):e[r]=e[r]||{_errors:[]},e=e[r],n++}}};return n(this),r}static assert(e){if(!(e instanceof ie))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ee.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){const t={},r=[];for(const n of this.issues)n.path.length>0?(t[n.path[0]]=t[n.path[0]]||[],t[n.path[0]].push(e(n))):r.push(e(n));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}ie.create=e=>new ie(e);const se=(e,t)=>{let r;switch(e.code){case ae.invalid_type:r=e.received===re.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case ae.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,ee.jsonStringifyReplacer)}`;break;case ae.unrecognized_keys:r=`Unrecognized key(s) in object: ${ee.joinValues(e.keys,", ")}`;break;case ae.invalid_union:r="Invalid input";break;case ae.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${ee.joinValues(e.options)}`;break;case ae.invalid_enum_value:r=`Invalid enum value. Expected ${ee.joinValues(e.options)}, received '${e.received}'`;break;case ae.invalid_arguments:r="Invalid function arguments";break;case ae.invalid_return_type:r="Invalid function return type";break;case ae.invalid_date:r="Invalid date";break;case ae.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:ee.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case ae.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case ae.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case ae.custom:r="Invalid input";break;case ae.invalid_intersection_types:r="Intersection results could not be merged";break;case ae.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case ae.not_finite:r="Number must be finite";break;default:r=t.defaultError,ee.assertNever(e)}return{message:r}};let oe=se;function le(){return oe}const ce=e=>{const{data:t,path:r,errorMaps:n,issueData:a}=e,i=[...r,...a.path||[]],s={...a,path:i};if(void 0!==a.message)return{...a,path:i,message:a.message};let o="";const l=n.filter((e=>!!e)).slice().reverse();for(const e of l)o=e(s,{data:t,defaultError:o}).message;return{...a,path:i,message:o}};function ue(e,t){const r=le(),n=ce({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===se?void 0:se].filter((e=>!!e))});e.common.issues.push(n)}class de{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const n of t){if("aborted"===n.status)return pe;"dirty"===n.status&&e.dirty(),r.push(n.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const e of t){const t=await e.key,n=await e.value;r.push({key:t,value:n})}return de.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const n of t){const{key:t,value:a}=n;if("aborted"===t.status)return pe;if("aborted"===a.status)return pe;"dirty"===t.status&&e.dirty(),"dirty"===a.status&&e.dirty(),"__proto__"===t.value||void 0===a.value&&!n.alwaysSet||(r[t.value]=a.value)}return{status:e.value,value:r}}}const pe=Object.freeze({status:"aborted"}),he=e=>({status:"dirty",value:e}),fe=e=>({status:"valid",value:e}),me=e=>"aborted"===e.status,ye=e=>"dirty"===e.status,ve=e=>"valid"===e.status,ge=e=>"undefined"!=typeof Promise&&e instanceof Promise;function _e(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}function be(e,t,r,n,a){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(e,r):a?a.value=r:t.set(e,r),r}var we,Oe,xe;"function"==typeof SuppressedError&&SuppressedError,function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(we||(we={}));class ke{constructor(e,t,r,n){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Se=(e,t)=>{if(ve(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new ie(e.common.issues);return this._error=t,this._error}}};function je(e){if(!e)return{};const{errorMap:t,invalid_type_error:r,required_error:n,description:a}=e;if(t&&(r||n))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:a}:{errorMap:(t,a)=>{var i,s;const{message:o}=e;return"invalid_enum_value"===t.code?{message:null!=o?o:a.defaultError}:void 0===a.data?{message:null!==(i=null!=o?o:n)&&void 0!==i?i:a.defaultError}:"invalid_type"!==t.code?{message:a.defaultError}:{message:null!==(s=null!=o?o:r)&&void 0!==s?s:a.defaultError}},description:a}}class Ee{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return ne(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:ne(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new de,ctx:{common:e.parent.common,data:e.data,parsedType:ne(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(ge(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const n={common:{issues:[],async:null!==(r=null==t?void 0:t.async)&&void 0!==r&&r,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ne(e)},a=this._parseSync({data:e,path:n.path,parent:n});return Se(n,a)}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ne(e)},n=this._parse({data:e,path:r.path,parent:r}),a=await(ge(n)?n:Promise.resolve(n));return Se(r,a)}refine(e,t){const r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement(((t,n)=>{const a=e(t),i=()=>n.addIssue({code:ae.custom,...r(t)});return"undefined"!=typeof Promise&&a instanceof Promise?a.then((e=>!!e||(i(),!1))):!!a||(i(),!1)}))}refinement(e,t){return this._refinement(((r,n)=>!!e(r)||(n.addIssue("function"==typeof t?t(r,n):t),!1)))}_refinement(e){return new wt({schema:this,typeName:Rt.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return Ot.create(this,this._def)}nullable(){return xt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return rt.create(this,this._def)}promise(){return bt.create(this,this._def)}or(e){return it.create([this,e],this._def)}and(e){return ct.create(this,e,this._def)}transform(e){return new wt({...je(this._def),schema:this,typeName:Rt.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new kt({...je(this._def),innerType:this,defaultValue:t,typeName:Rt.ZodDefault})}brand(){return new Tt({typeName:Rt.ZodBranded,type:this,...je(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new St({...je(this._def),innerType:this,catchValue:t,typeName:Rt.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return Pt.create(this,e)}readonly(){return Ct.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Te=/^c[^\s-]{8,}$/i,Pe=/^[0-9a-z]+$/,Ce=/^[0-9A-HJKMNP-TV-Z]{26}$/,Ne=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Ze=/^[a-z0-9_-]{21}$/i,Re=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,ze=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let Ie;const Ae=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Me=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,De=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,$e="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Le=new RegExp(`^${$e}$`);function Fe(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`),t}function Ve(e){let t=`${$e}T${Fe(e)}`;const r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,new RegExp(`^${t}$`)}class We extends Ee{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==re.string){const t=this._getOrReturnCtx(e);return ue(t,{code:ae.invalid_type,expected:re.string,received:t.parsedType}),pe}const t=new de;let r;for(const i of this._def.checks)if("min"===i.kind)e.data.length<i.value&&(r=this._getOrReturnCtx(e,r),ue(r,{code:ae.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),t.dirty());else if("max"===i.kind)e.data.length>i.value&&(r=this._getOrReturnCtx(e,r),ue(r,{code:ae.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),t.dirty());else if("length"===i.kind){const n=e.data.length>i.value,a=e.data.length<i.value;(n||a)&&(r=this._getOrReturnCtx(e,r),n?ue(r,{code:ae.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):a&&ue(r,{code:ae.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),t.dirty())}else if("email"===i.kind)ze.test(e.data)||(r=this._getOrReturnCtx(e,r),ue(r,{validation:"email",code:ae.invalid_string,message:i.message}),t.dirty());else if("emoji"===i.kind)Ie||(Ie=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Ie.test(e.data)||(r=this._getOrReturnCtx(e,r),ue(r,{validation:"emoji",code:ae.invalid_string,message:i.message}),t.dirty());else if("uuid"===i.kind)Ne.test(e.data)||(r=this._getOrReturnCtx(e,r),ue(r,{validation:"uuid",code:ae.invalid_string,message:i.message}),t.dirty());else if("nanoid"===i.kind)Ze.test(e.data)||(r=this._getOrReturnCtx(e,r),ue(r,{validation:"nanoid",code:ae.invalid_string,message:i.message}),t.dirty());else if("cuid"===i.kind)Te.test(e.data)||(r=this._getOrReturnCtx(e,r),ue(r,{validation:"cuid",code:ae.invalid_string,message:i.message}),t.dirty());else if("cuid2"===i.kind)Pe.test(e.data)||(r=this._getOrReturnCtx(e,r),ue(r,{validation:"cuid2",code:ae.invalid_string,message:i.message}),t.dirty());else if("ulid"===i.kind)Ce.test(e.data)||(r=this._getOrReturnCtx(e,r),ue(r,{validation:"ulid",code:ae.invalid_string,message:i.message}),t.dirty());else if("url"===i.kind)try{new URL(e.data)}catch(n){r=this._getOrReturnCtx(e,r),ue(r,{validation:"url",code:ae.invalid_string,message:i.message}),t.dirty()}else"regex"===i.kind?(i.regex.lastIndex=0,i.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),ue(r,{validation:"regex",code:ae.invalid_string,message:i.message}),t.dirty())):"trim"===i.kind?e.data=e.data.trim():"includes"===i.kind?e.data.includes(i.value,i.position)||(r=this._getOrReturnCtx(e,r),ue(r,{code:ae.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),t.dirty()):"toLowerCase"===i.kind?e.data=e.data.toLowerCase():"toUpperCase"===i.kind?e.data=e.data.toUpperCase():"startsWith"===i.kind?e.data.startsWith(i.value)||(r=this._getOrReturnCtx(e,r),ue(r,{code:ae.invalid_string,validation:{startsWith:i.value},message:i.message}),t.dirty()):"endsWith"===i.kind?e.data.endsWith(i.value)||(r=this._getOrReturnCtx(e,r),ue(r,{code:ae.invalid_string,validation:{endsWith:i.value},message:i.message}),t.dirty()):"datetime"===i.kind?Ve(i).test(e.data)||(r=this._getOrReturnCtx(e,r),ue(r,{code:ae.invalid_string,validation:"datetime",message:i.message}),t.dirty()):"date"===i.kind?Le.test(e.data)||(r=this._getOrReturnCtx(e,r),ue(r,{code:ae.invalid_string,validation:"date",message:i.message}),t.dirty()):"time"===i.kind?new RegExp(`^${Fe(i)}$`).test(e.data)||(r=this._getOrReturnCtx(e,r),ue(r,{code:ae.invalid_string,validation:"time",message:i.message}),t.dirty()):"duration"===i.kind?Re.test(e.data)||(r=this._getOrReturnCtx(e,r),ue(r,{validation:"duration",code:ae.invalid_string,message:i.message}),t.dirty()):"ip"===i.kind?(n=e.data,("v4"!==(a=i.version)&&a||!Ae.test(n))&&("v6"!==a&&a||!Me.test(n))&&(r=this._getOrReturnCtx(e,r),ue(r,{validation:"ip",code:ae.invalid_string,message:i.message}),t.dirty())):"base64"===i.kind?De.test(e.data)||(r=this._getOrReturnCtx(e,r),ue(r,{validation:"base64",code:ae.invalid_string,message:i.message}),t.dirty()):ee.assertNever(i);var n,a;return{status:t.value,value:e.data}}_regex(e,t,r){return this.refinement((t=>e.test(t)),{validation:t,code:ae.invalid_string,...we.errToObj(r)})}_addCheck(e){return new We({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...we.errToObj(e)})}url(e){return this._addCheck({kind:"url",...we.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...we.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...we.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...we.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...we.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...we.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...we.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...we.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...we.errToObj(e)})}datetime(e){var t,r;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,local:null!==(r=null==e?void 0:e.local)&&void 0!==r&&r,...we.errToObj(null==e?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,...we.errToObj(null==e?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...we.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...we.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...we.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...we.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...we.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...we.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...we.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...we.errToObj(t)})}nonempty(e){return this.min(1,we.errToObj(e))}trim(){return new We({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new We({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new We({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((e=>"datetime"===e.kind))}get isDate(){return!!this._def.checks.find((e=>"date"===e.kind))}get isTime(){return!!this._def.checks.find((e=>"time"===e.kind))}get isDuration(){return!!this._def.checks.find((e=>"duration"===e.kind))}get isEmail(){return!!this._def.checks.find((e=>"email"===e.kind))}get isURL(){return!!this._def.checks.find((e=>"url"===e.kind))}get isEmoji(){return!!this._def.checks.find((e=>"emoji"===e.kind))}get isUUID(){return!!this._def.checks.find((e=>"uuid"===e.kind))}get isNANOID(){return!!this._def.checks.find((e=>"nanoid"===e.kind))}get isCUID(){return!!this._def.checks.find((e=>"cuid"===e.kind))}get isCUID2(){return!!this._def.checks.find((e=>"cuid2"===e.kind))}get isULID(){return!!this._def.checks.find((e=>"ulid"===e.kind))}get isIP(){return!!this._def.checks.find((e=>"ip"===e.kind))}get isBase64(){return!!this._def.checks.find((e=>"base64"===e.kind))}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function qe(e,t){const r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,a=r>n?r:n;return parseInt(e.toFixed(a).replace(".",""))%parseInt(t.toFixed(a).replace(".",""))/Math.pow(10,a)}We.create=e=>{var t;return new We({checks:[],typeName:Rt.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...je(e)})};class Be extends Ee{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==re.number){const t=this._getOrReturnCtx(e);return ue(t,{code:ae.invalid_type,expected:re.number,received:t.parsedType}),pe}let t;const r=new de;for(const n of this._def.checks)"int"===n.kind?ee.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),ue(t,{code:ae.invalid_type,expected:"integer",received:"float",message:n.message}),r.dirty()):"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(t=this._getOrReturnCtx(e,t),ue(t,{code:ae.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(t=this._getOrReturnCtx(e,t),ue(t,{code:ae.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):"multipleOf"===n.kind?0!==qe(e.data,n.value)&&(t=this._getOrReturnCtx(e,t),ue(t,{code:ae.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):"finite"===n.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),ue(t,{code:ae.not_finite,message:n.message}),r.dirty()):ee.assertNever(n);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,we.toString(t))}gt(e,t){return this.setLimit("min",e,!1,we.toString(t))}lte(e,t){return this.setLimit("max",e,!0,we.toString(t))}lt(e,t){return this.setLimit("max",e,!1,we.toString(t))}setLimit(e,t,r,n){return new Be({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:we.toString(n)}]})}_addCheck(e){return new Be({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:we.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:we.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:we.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:we.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:we.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:we.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:we.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:we.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:we.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find((e=>"int"===e.kind||"multipleOf"===e.kind&&ee.isInteger(e.value)))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Be.create=e=>new Be({checks:[],typeName:Rt.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...je(e)});class Ue extends Ee{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==re.bigint){const t=this._getOrReturnCtx(e);return ue(t,{code:ae.invalid_type,expected:re.bigint,received:t.parsedType}),pe}let t;const r=new de;for(const n of this._def.checks)"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(t=this._getOrReturnCtx(e,t),ue(t,{code:ae.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(t=this._getOrReturnCtx(e,t),ue(t,{code:ae.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):"multipleOf"===n.kind?e.data%n.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),ue(t,{code:ae.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):ee.assertNever(n);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,we.toString(t))}gt(e,t){return this.setLimit("min",e,!1,we.toString(t))}lte(e,t){return this.setLimit("max",e,!0,we.toString(t))}lt(e,t){return this.setLimit("max",e,!1,we.toString(t))}setLimit(e,t,r,n){return new Ue({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:we.toString(n)}]})}_addCheck(e){return new Ue({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:we.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:we.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:we.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:we.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:we.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}Ue.create=e=>{var t;return new Ue({checks:[],typeName:Rt.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...je(e)})};class Ke extends Ee{_parse(e){if(this._def.coerce&&(e.data=Boolean(e.data)),this._getType(e)!==re.boolean){const t=this._getOrReturnCtx(e);return ue(t,{code:ae.invalid_type,expected:re.boolean,received:t.parsedType}),pe}return fe(e.data)}}Ke.create=e=>new Ke({typeName:Rt.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...je(e)});class He extends Ee{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==re.date){const t=this._getOrReturnCtx(e);return ue(t,{code:ae.invalid_type,expected:re.date,received:t.parsedType}),pe}if(isNaN(e.data.getTime()))return ue(this._getOrReturnCtx(e),{code:ae.invalid_date}),pe;const t=new de;let r;for(const n of this._def.checks)"min"===n.kind?e.data.getTime()<n.value&&(r=this._getOrReturnCtx(e,r),ue(r,{code:ae.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),t.dirty()):"max"===n.kind?e.data.getTime()>n.value&&(r=this._getOrReturnCtx(e,r),ue(r,{code:ae.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),t.dirty()):ee.assertNever(n);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new He({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:we.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:we.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}He.create=e=>new He({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:Rt.ZodDate,...je(e)});class Je extends Ee{_parse(e){if(this._getType(e)!==re.symbol){const t=this._getOrReturnCtx(e);return ue(t,{code:ae.invalid_type,expected:re.symbol,received:t.parsedType}),pe}return fe(e.data)}}Je.create=e=>new Je({typeName:Rt.ZodSymbol,...je(e)});class Qe extends Ee{_parse(e){if(this._getType(e)!==re.undefined){const t=this._getOrReturnCtx(e);return ue(t,{code:ae.invalid_type,expected:re.undefined,received:t.parsedType}),pe}return fe(e.data)}}Qe.create=e=>new Qe({typeName:Rt.ZodUndefined,...je(e)});class Ye extends Ee{_parse(e){if(this._getType(e)!==re.null){const t=this._getOrReturnCtx(e);return ue(t,{code:ae.invalid_type,expected:re.null,received:t.parsedType}),pe}return fe(e.data)}}Ye.create=e=>new Ye({typeName:Rt.ZodNull,...je(e)});class Ge extends Ee{constructor(){super(...arguments),this._any=!0}_parse(e){return fe(e.data)}}Ge.create=e=>new Ge({typeName:Rt.ZodAny,...je(e)});class Xe extends Ee{constructor(){super(...arguments),this._unknown=!0}_parse(e){return fe(e.data)}}Xe.create=e=>new Xe({typeName:Rt.ZodUnknown,...je(e)});class et extends Ee{_parse(e){const t=this._getOrReturnCtx(e);return ue(t,{code:ae.invalid_type,expected:re.never,received:t.parsedType}),pe}}et.create=e=>new et({typeName:Rt.ZodNever,...je(e)});class tt extends Ee{_parse(e){if(this._getType(e)!==re.undefined){const t=this._getOrReturnCtx(e);return ue(t,{code:ae.invalid_type,expected:re.void,received:t.parsedType}),pe}return fe(e.data)}}tt.create=e=>new tt({typeName:Rt.ZodVoid,...je(e)});class rt extends Ee{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),n=this._def;if(t.parsedType!==re.array)return ue(t,{code:ae.invalid_type,expected:re.array,received:t.parsedType}),pe;if(null!==n.exactLength){const e=t.data.length>n.exactLength.value,a=t.data.length<n.exactLength.value;(e||a)&&(ue(t,{code:e?ae.too_big:ae.too_small,minimum:a?n.exactLength.value:void 0,maximum:e?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),r.dirty())}if(null!==n.minLength&&t.data.length<n.minLength.value&&(ue(t,{code:ae.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),r.dirty()),null!==n.maxLength&&t.data.length>n.maxLength.value&&(ue(t,{code:ae.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map(((e,r)=>n.type._parseAsync(new ke(t,e,t.path,r))))).then((e=>de.mergeArray(r,e)));const a=[...t.data].map(((e,r)=>n.type._parseSync(new ke(t,e,t.path,r))));return de.mergeArray(r,a)}get element(){return this._def.type}min(e,t){return new rt({...this._def,minLength:{value:e,message:we.toString(t)}})}max(e,t){return new rt({...this._def,maxLength:{value:e,message:we.toString(t)}})}length(e,t){return new rt({...this._def,exactLength:{value:e,message:we.toString(t)}})}nonempty(e){return this.min(1,e)}}function nt(e){if(e instanceof at){const t={};for(const r in e.shape){const n=e.shape[r];t[r]=Ot.create(nt(n))}return new at({...e._def,shape:()=>t})}return e instanceof rt?new rt({...e._def,type:nt(e.element)}):e instanceof Ot?Ot.create(nt(e.unwrap())):e instanceof xt?xt.create(nt(e.unwrap())):e instanceof ut?ut.create(e.items.map((e=>nt(e)))):e}rt.create=(e,t)=>new rt({type:e,minLength:null,maxLength:null,exactLength:null,typeName:Rt.ZodArray,...je(t)});class at extends Ee{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=ee.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==re.object){const t=this._getOrReturnCtx(e);return ue(t,{code:ae.invalid_type,expected:re.object,received:t.parsedType}),pe}const{status:t,ctx:r}=this._processInputParams(e),{shape:n,keys:a}=this._getCached(),i=[];if(!(this._def.catchall instanceof et&&"strip"===this._def.unknownKeys))for(const e in r.data)a.includes(e)||i.push(e);const s=[];for(const e of a){const t=n[e],a=r.data[e];s.push({key:{status:"valid",value:e},value:t._parse(new ke(r,a,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof et){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of i)s.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)i.length>0&&(ue(r,{code:ae.unrecognized_keys,keys:i}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of i){const n=r.data[t];s.push({key:{status:"valid",value:t},value:e._parse(new ke(r,n,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then((async()=>{const e=[];for(const t of s){const r=await t.key,n=await t.value;e.push({key:r,value:n,alwaysSet:t.alwaysSet})}return e})).then((e=>de.mergeObjectSync(t,e))):de.mergeObjectSync(t,s)}get shape(){return this._def.shape()}strict(e){return we.errToObj,new at({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{var n,a,i,s;const o=null!==(i=null===(a=(n=this._def).errorMap)||void 0===a?void 0:a.call(n,t,r).message)&&void 0!==i?i:r.defaultError;return"unrecognized_keys"===t.code?{message:null!==(s=we.errToObj(e).message)&&void 0!==s?s:o}:{message:o}}}:{}})}strip(){return new at({...this._def,unknownKeys:"strip"})}passthrough(){return new at({...this._def,unknownKeys:"passthrough"})}extend(e){return new at({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new at({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Rt.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new at({...this._def,catchall:e})}pick(e){const t={};return ee.objectKeys(e).forEach((r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])})),new at({...this._def,shape:()=>t})}omit(e){const t={};return ee.objectKeys(this.shape).forEach((r=>{e[r]||(t[r]=this.shape[r])})),new at({...this._def,shape:()=>t})}deepPartial(){return nt(this)}partial(e){const t={};return ee.objectKeys(this.shape).forEach((r=>{const n=this.shape[r];e&&!e[r]?t[r]=n:t[r]=n.optional()})),new at({...this._def,shape:()=>t})}required(e){const t={};return ee.objectKeys(this.shape).forEach((r=>{if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof Ot;)e=e._def.innerType;t[r]=e}})),new at({...this._def,shape:()=>t})}keyof(){return vt(ee.objectKeys(this.shape))}}at.create=(e,t)=>new at({shape:()=>e,unknownKeys:"strip",catchall:et.create(),typeName:Rt.ZodObject,...je(t)}),at.strictCreate=(e,t)=>new at({shape:()=>e,unknownKeys:"strict",catchall:et.create(),typeName:Rt.ZodObject,...je(t)}),at.lazycreate=(e,t)=>new at({shape:e,unknownKeys:"strip",catchall:et.create(),typeName:Rt.ZodObject,...je(t)});class it extends Ee{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map((async e=>{const r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}}))).then((function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;const r=e.map((e=>new ie(e.ctx.common.issues)));return ue(t,{code:ae.invalid_union,unionErrors:r}),pe}));{let e;const n=[];for(const a of r){const r={...t,common:{...t.common,issues:[]},parent:null},i=a._parseSync({data:t.data,path:t.path,parent:r});if("valid"===i.status)return i;"dirty"!==i.status||e||(e={result:i,ctx:r}),r.common.issues.length&&n.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const a=n.map((e=>new ie(e)));return ue(t,{code:ae.invalid_union,unionErrors:a}),pe}}get options(){return this._def.options}}it.create=(e,t)=>new it({options:e,typeName:Rt.ZodUnion,...je(t)});const st=e=>e instanceof mt?st(e.schema):e instanceof wt?st(e.innerType()):e instanceof yt?[e.value]:e instanceof gt?e.options:e instanceof _t?ee.objectValues(e.enum):e instanceof kt?st(e._def.innerType):e instanceof Qe?[void 0]:e instanceof Ye?[null]:e instanceof Ot?[void 0,...st(e.unwrap())]:e instanceof xt?[null,...st(e.unwrap())]:e instanceof Tt||e instanceof Ct?st(e.unwrap()):e instanceof St?st(e._def.innerType):[];class ot extends Ee{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==re.object)return ue(t,{code:ae.invalid_type,expected:re.object,received:t.parsedType}),pe;const r=this.discriminator,n=t.data[r],a=this.optionsMap.get(n);return a?t.common.async?a._parseAsync({data:t.data,path:t.path,parent:t}):a._parseSync({data:t.data,path:t.path,parent:t}):(ue(t,{code:ae.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),pe)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const n=new Map;for(const r of t){const t=st(r.shape[e]);if(!t.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const a of t){if(n.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);n.set(a,r)}}return new ot({typeName:Rt.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:n,...je(r)})}}function lt(e,t){const r=ne(e),n=ne(t);if(e===t)return{valid:!0,data:e};if(r===re.object&&n===re.object){const r=ee.objectKeys(t),n=ee.objectKeys(e).filter((e=>-1!==r.indexOf(e))),a={...e,...t};for(const r of n){const n=lt(e[r],t[r]);if(!n.valid)return{valid:!1};a[r]=n.data}return{valid:!0,data:a}}if(r===re.array&&n===re.array){if(e.length!==t.length)return{valid:!1};const r=[];for(let n=0;n<e.length;n++){const a=lt(e[n],t[n]);if(!a.valid)return{valid:!1};r.push(a.data)}return{valid:!0,data:r}}return r===re.date&&n===re.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class ct extends Ee{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),n=(e,n)=>{if(me(e)||me(n))return pe;const a=lt(e.value,n.value);return a.valid?((ye(e)||ye(n))&&t.dirty(),{status:t.value,value:a.data}):(ue(r,{code:ae.invalid_intersection_types}),pe)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then((([e,t])=>n(e,t))):n(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}ct.create=(e,t,r)=>new ct({left:e,right:t,typeName:Rt.ZodIntersection,...je(r)});class ut extends Ee{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==re.array)return ue(r,{code:ae.invalid_type,expected:re.array,received:r.parsedType}),pe;if(r.data.length<this._def.items.length)return ue(r,{code:ae.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),pe;!this._def.rest&&r.data.length>this._def.items.length&&(ue(r,{code:ae.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const n=[...r.data].map(((e,t)=>{const n=this._def.items[t]||this._def.rest;return n?n._parse(new ke(r,e,r.path,t)):null})).filter((e=>!!e));return r.common.async?Promise.all(n).then((e=>de.mergeArray(t,e))):de.mergeArray(t,n)}get items(){return this._def.items}rest(e){return new ut({...this._def,rest:e})}}ut.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ut({items:e,typeName:Rt.ZodTuple,rest:null,...je(t)})};class dt extends Ee{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==re.object)return ue(r,{code:ae.invalid_type,expected:re.object,received:r.parsedType}),pe;const n=[],a=this._def.keyType,i=this._def.valueType;for(const e in r.data)n.push({key:a._parse(new ke(r,e,r.path,e)),value:i._parse(new ke(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?de.mergeObjectAsync(t,n):de.mergeObjectSync(t,n)}get element(){return this._def.valueType}static create(e,t,r){return new dt(t instanceof Ee?{keyType:e,valueType:t,typeName:Rt.ZodRecord,...je(r)}:{keyType:We.create(),valueType:e,typeName:Rt.ZodRecord,...je(t)})}}class pt extends Ee{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==re.map)return ue(r,{code:ae.invalid_type,expected:re.map,received:r.parsedType}),pe;const n=this._def.keyType,a=this._def.valueType,i=[...r.data.entries()].map((([e,t],i)=>({key:n._parse(new ke(r,e,r.path,[i,"key"])),value:a._parse(new ke(r,t,r.path,[i,"value"]))})));if(r.common.async){const e=new Map;return Promise.resolve().then((async()=>{for(const r of i){const n=await r.key,a=await r.value;if("aborted"===n.status||"aborted"===a.status)return pe;"dirty"!==n.status&&"dirty"!==a.status||t.dirty(),e.set(n.value,a.value)}return{status:t.value,value:e}}))}{const e=new Map;for(const r of i){const n=r.key,a=r.value;if("aborted"===n.status||"aborted"===a.status)return pe;"dirty"!==n.status&&"dirty"!==a.status||t.dirty(),e.set(n.value,a.value)}return{status:t.value,value:e}}}}pt.create=(e,t,r)=>new pt({valueType:t,keyType:e,typeName:Rt.ZodMap,...je(r)});class ht extends Ee{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==re.set)return ue(r,{code:ae.invalid_type,expected:re.set,received:r.parsedType}),pe;const n=this._def;null!==n.minSize&&r.data.size<n.minSize.value&&(ue(r,{code:ae.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),t.dirty()),null!==n.maxSize&&r.data.size>n.maxSize.value&&(ue(r,{code:ae.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),t.dirty());const a=this._def.valueType;function i(e){const r=new Set;for(const n of e){if("aborted"===n.status)return pe;"dirty"===n.status&&t.dirty(),r.add(n.value)}return{status:t.value,value:r}}const s=[...r.data.values()].map(((e,t)=>a._parse(new ke(r,e,r.path,t))));return r.common.async?Promise.all(s).then((e=>i(e))):i(s)}min(e,t){return new ht({...this._def,minSize:{value:e,message:we.toString(t)}})}max(e,t){return new ht({...this._def,maxSize:{value:e,message:we.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}ht.create=(e,t)=>new ht({valueType:e,minSize:null,maxSize:null,typeName:Rt.ZodSet,...je(t)});class ft extends Ee{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==re.function)return ue(t,{code:ae.invalid_type,expected:re.function,received:t.parsedType}),pe;function r(e,r){return ce({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,le(),se].filter((e=>!!e)),issueData:{code:ae.invalid_arguments,argumentsError:r}})}function n(e,r){return ce({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,le(),se].filter((e=>!!e)),issueData:{code:ae.invalid_return_type,returnTypeError:r}})}const a={errorMap:t.common.contextualErrorMap},i=t.data;if(this._def.returns instanceof bt){const e=this;return fe((async function(...t){const s=new ie([]),o=await e._def.args.parseAsync(t,a).catch((e=>{throw s.addIssue(r(t,e)),s})),l=await Reflect.apply(i,this,o),c=await e._def.returns._def.type.parseAsync(l,a).catch((e=>{throw s.addIssue(n(l,e)),s}));return c}))}{const e=this;return fe((function(...t){const s=e._def.args.safeParse(t,a);if(!s.success)throw new ie([r(t,s.error)]);const o=Reflect.apply(i,this,s.data),l=e._def.returns.safeParse(o,a);if(!l.success)throw new ie([n(o,l.error)]);return l.data}))}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new ft({...this._def,args:ut.create(e).rest(Xe.create())})}returns(e){return new ft({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new ft({args:e||ut.create([]).rest(Xe.create()),returns:t||Xe.create(),typeName:Rt.ZodFunction,...je(r)})}}class mt extends Ee{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}mt.create=(e,t)=>new mt({getter:e,typeName:Rt.ZodLazy,...je(t)});class yt extends Ee{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return ue(t,{received:t.data,code:ae.invalid_literal,expected:this._def.value}),pe}return{status:"valid",value:e.data}}get value(){return this._def.value}}function vt(e,t){return new gt({values:e,typeName:Rt.ZodEnum,...je(t)})}yt.create=(e,t)=>new yt({value:e,typeName:Rt.ZodLiteral,...je(t)});class gt extends Ee{constructor(){super(...arguments),Oe.set(this,void 0)}_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),r=this._def.values;return ue(t,{expected:ee.joinValues(r),received:t.parsedType,code:ae.invalid_type}),pe}if(_e(this,Oe,"f")||be(this,Oe,new Set(this._def.values),"f"),!_e(this,Oe,"f").has(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return ue(t,{received:t.data,code:ae.invalid_enum_value,options:r}),pe}return fe(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return gt.create(e,{...this._def,...t})}exclude(e,t=this._def){return gt.create(this.options.filter((t=>!e.includes(t))),{...this._def,...t})}}Oe=new WeakMap,gt.create=vt;class _t extends Ee{constructor(){super(...arguments),xe.set(this,void 0)}_parse(e){const t=ee.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==re.string&&r.parsedType!==re.number){const e=ee.objectValues(t);return ue(r,{expected:ee.joinValues(e),received:r.parsedType,code:ae.invalid_type}),pe}if(_e(this,xe,"f")||be(this,xe,new Set(ee.getValidEnumValues(this._def.values)),"f"),!_e(this,xe,"f").has(e.data)){const e=ee.objectValues(t);return ue(r,{received:r.data,code:ae.invalid_enum_value,options:e}),pe}return fe(e.data)}get enum(){return this._def.values}}xe=new WeakMap,_t.create=(e,t)=>new _t({values:e,typeName:Rt.ZodNativeEnum,...je(t)});class bt extends Ee{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==re.promise&&!1===t.common.async)return ue(t,{code:ae.invalid_type,expected:re.promise,received:t.parsedType}),pe;const r=t.parsedType===re.promise?t.data:Promise.resolve(t.data);return fe(r.then((e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap}))))}}bt.create=(e,t)=>new bt({type:e,typeName:Rt.ZodPromise,...je(t)});class wt extends Ee{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Rt.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),n=this._def.effect||null,a={addIssue:e=>{ue(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(a.addIssue=a.addIssue.bind(a),"preprocess"===n.type){const e=n.transform(r.data,a);if(r.common.async)return Promise.resolve(e).then((async e=>{if("aborted"===t.value)return pe;const n=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===n.status?pe:"dirty"===n.status||"dirty"===t.value?he(n.value):n}));{if("aborted"===t.value)return pe;const n=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===n.status?pe:"dirty"===n.status||"dirty"===t.value?he(n.value):n}}if("refinement"===n.type){const e=e=>{const t=n.refinement(e,a);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===r.common.async){const n=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===n.status?pe:("dirty"===n.status&&t.dirty(),e(n.value),{status:t.value,value:n.value})}return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then((r=>"aborted"===r.status?pe:("dirty"===r.status&&t.dirty(),e(r.value).then((()=>({status:t.value,value:r.value}))))))}if("transform"===n.type){if(!1===r.common.async){const e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!ve(e))return e;const i=n.transform(e.value,a);if(i instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:i}}return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then((e=>ve(e)?Promise.resolve(n.transform(e.value,a)).then((e=>({status:t.value,value:e}))):e))}ee.assertNever(n)}}wt.create=(e,t,r)=>new wt({schema:e,typeName:Rt.ZodEffects,effect:t,...je(r)}),wt.createWithPreprocess=(e,t,r)=>new wt({schema:t,effect:{type:"preprocess",transform:e},typeName:Rt.ZodEffects,...je(r)});class Ot extends Ee{_parse(e){return this._getType(e)===re.undefined?fe(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ot.create=(e,t)=>new Ot({innerType:e,typeName:Rt.ZodOptional,...je(t)});class xt extends Ee{_parse(e){return this._getType(e)===re.null?fe(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}xt.create=(e,t)=>new xt({innerType:e,typeName:Rt.ZodNullable,...je(t)});class kt extends Ee{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===re.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}kt.create=(e,t)=>new kt({innerType:e,typeName:Rt.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...je(t)});class St extends Ee{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},n=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return ge(n)?n.then((e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new ie(r.common.issues)},input:r.data})}))):{status:"valid",value:"valid"===n.status?n.value:this._def.catchValue({get error(){return new ie(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}St.create=(e,t)=>new St({innerType:e,typeName:Rt.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...je(t)});class jt extends Ee{_parse(e){if(this._getType(e)!==re.nan){const t=this._getOrReturnCtx(e);return ue(t,{code:ae.invalid_type,expected:re.nan,received:t.parsedType}),pe}return{status:"valid",value:e.data}}}jt.create=e=>new jt({typeName:Rt.ZodNaN,...je(e)});const Et=Symbol("zod_brand");class Tt extends Ee{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class Pt extends Ee{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?pe:"dirty"===e.status?(t.dirty(),he(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{const e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?pe:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new Pt({in:e,out:t,typeName:Rt.ZodPipeline})}}class Ct extends Ee{_parse(e){const t=this._def.innerType._parse(e),r=e=>(ve(e)&&(e.value=Object.freeze(e.value)),e);return ge(t)?t.then((e=>r(e))):r(t)}unwrap(){return this._def.innerType}}function Nt(e,t={},r){return e?Ge.create().superRefine(((n,a)=>{var i,s;if(!e(n)){const e="function"==typeof t?t(n):"string"==typeof t?{message:t}:t,o=null===(s=null!==(i=e.fatal)&&void 0!==i?i:r)||void 0===s||s,l="string"==typeof e?{message:e}:e;a.addIssue({code:"custom",...l,fatal:o})}})):Ge.create()}Ct.create=(e,t)=>new Ct({innerType:e,typeName:Rt.ZodReadonly,...je(t)});const Zt={object:at.lazycreate};var Rt;!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(Rt||(Rt={}));const zt=We.create,It=Be.create,At=jt.create,Mt=Ue.create,Dt=Ke.create,$t=He.create,Lt=Je.create,Ft=Qe.create,Vt=Ye.create,Wt=Ge.create,qt=Xe.create,Bt=et.create,Ut=tt.create,Kt=rt.create,Ht=at.create,Jt=at.strictCreate,Qt=it.create,Yt=ot.create,Gt=ct.create,Xt=ut.create,er=dt.create,tr=pt.create,rr=ht.create,nr=ft.create,ar=mt.create,ir=yt.create,sr=gt.create,or=_t.create,lr=bt.create,cr=wt.create,ur=Ot.create,dr=xt.create,pr=wt.createWithPreprocess,hr=Pt.create,fr={string:e=>We.create({...e,coerce:!0}),number:e=>Be.create({...e,coerce:!0}),boolean:e=>Ke.create({...e,coerce:!0}),bigint:e=>Ue.create({...e,coerce:!0}),date:e=>He.create({...e,coerce:!0})},mr=pe;var yr=Object.freeze({__proto__:null,defaultErrorMap:se,setErrorMap:function(e){oe=e},getErrorMap:le,makeIssue:ce,EMPTY_PATH:[],addIssueToContext:ue,ParseStatus:de,INVALID:pe,DIRTY:he,OK:fe,isAborted:me,isDirty:ye,isValid:ve,isAsync:ge,get util(){return ee},get objectUtil(){return te},ZodParsedType:re,getParsedType:ne,ZodType:Ee,datetimeRegex:Ve,ZodString:We,ZodNumber:Be,ZodBigInt:Ue,ZodBoolean:Ke,ZodDate:He,ZodSymbol:Je,ZodUndefined:Qe,ZodNull:Ye,ZodAny:Ge,ZodUnknown:Xe,ZodNever:et,ZodVoid:tt,ZodArray:rt,ZodObject:at,ZodUnion:it,ZodDiscriminatedUnion:ot,ZodIntersection:ct,ZodTuple:ut,ZodRecord:dt,ZodMap:pt,ZodSet:ht,ZodFunction:ft,ZodLazy:mt,ZodLiteral:yt,ZodEnum:gt,ZodNativeEnum:_t,ZodPromise:bt,ZodEffects:wt,ZodTransformer:wt,ZodOptional:Ot,ZodNullable:xt,ZodDefault:kt,ZodCatch:St,ZodNaN:jt,BRAND:Et,ZodBranded:Tt,ZodPipeline:Pt,ZodReadonly:Ct,custom:Nt,Schema:Ee,ZodSchema:Ee,late:Zt,get ZodFirstPartyTypeKind(){return Rt},coerce:fr,any:Wt,array:Kt,bigint:Mt,boolean:Dt,date:$t,discriminatedUnion:Yt,effect:cr,enum:sr,function:nr,instanceof:(e,t={message:`Input not instance of ${e.name}`})=>Nt((t=>t instanceof e),t),intersection:Gt,lazy:ar,literal:ir,map:tr,nan:At,nativeEnum:or,never:Bt,null:Vt,nullable:dr,number:It,object:Ht,oboolean:()=>Dt().optional(),onumber:()=>It().optional(),optional:ur,ostring:()=>zt().optional(),pipeline:hr,preprocess:pr,promise:lr,record:er,set:rr,strictObject:Jt,string:zt,symbol:Lt,transformer:cr,tuple:Xt,undefined:Ft,union:Qt,unknown:qt,void:Ut,NEVER:mr,ZodIssueCode:ae,quotelessJson:e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:ie});const vr=Symbol.for("@ts-pattern/matcher"),gr=Symbol.for("@ts-pattern/isVariadic"),_r="@ts-pattern/anonymous-select-key",br=e=>Boolean(e&&"object"==typeof e),wr=e=>e&&!!e[vr],Or=(e,t,r)=>{if(wr(e)){const n=e[vr](),{matched:a,selections:i}=n.match(t);return a&&i&&Object.keys(i).forEach((e=>r(e,i[e]))),a}if(br(e)){if(!br(t))return!1;if(Array.isArray(e)){if(!Array.isArray(t))return!1;let n=[],a=[],i=[];for(const t of e.keys()){const r=e[t];wr(r)&&r[gr]?i.push(r):i.length?a.push(r):n.push(r)}if(i.length){if(i.length>1)throw new Error("Pattern error: Using `...P.array(...)` several times in a single pattern is not allowed.");if(t.length<n.length+a.length)return!1;const e=t.slice(0,n.length),s=0===a.length?[]:t.slice(-a.length),o=t.slice(n.length,0===a.length?1/0:-a.length);return n.every(((t,n)=>Or(t,e[n],r)))&&a.every(((e,t)=>Or(e,s[t],r)))&&(0===i.length||Or(i[0],o,r))}return e.length===t.length&&e.every(((e,n)=>Or(e,t[n],r)))}return Reflect.ownKeys(e).every((n=>{const a=e[n];return(n in t||wr(i=a)&&"optional"===i[vr]().matcherType)&&Or(a,t[n],r);var i}))}return Object.is(t,e)},xr=e=>{var t,r,n;return br(e)?wr(e)?null!=(t=null==(r=(n=e[vr]()).getSelectionKeys)?void 0:r.call(n))?t:[]:Array.isArray(e)?kr(e,xr):kr(Object.values(e),xr):[]},kr=(e,t)=>e.reduce(((e,r)=>e.concat(t(r))),[]);function Sr(e){return Object.assign(e,{optional:()=>Er(e),and:t=>Cr(e,t),or:t=>Nr(e,t),select:t=>void 0===t?Rr(e):Rr(t,e)})}function jr(e){return Object.assign((e=>Object.assign(e,{[Symbol.iterator](){let t=0;const r=[{value:Object.assign(e,{[gr]:!0}),done:!1},{done:!0,value:void 0}];return{next:()=>{var e;return null!=(e=r[t++])?e:r.at(-1)}}}}))(e),{optional:()=>jr(Er(e)),select:t=>jr(void 0===t?Rr(e):Rr(t,e))})}function Er(e){return Sr({[vr]:()=>({match:t=>{let r={};const n=(e,t)=>{r[e]=t};return void 0===t?(xr(e).forEach((e=>n(e,void 0))),{matched:!0,selections:r}):{matched:Or(e,t,n),selections:r}},getSelectionKeys:()=>xr(e),matcherType:"optional"})})}const Tr=(e,t)=>{for(const r of e)if(!t(r))return!1;return!0},Pr=(e,t)=>{for(const[r,n]of e.entries())if(!t(n,r))return!1;return!0};function Cr(...e){return Sr({[vr]:()=>({match:t=>{let r={};const n=(e,t)=>{r[e]=t};return{matched:e.every((e=>Or(e,t,n))),selections:r}},getSelectionKeys:()=>kr(e,xr),matcherType:"and"})})}function Nr(...e){return Sr({[vr]:()=>({match:t=>{let r={};const n=(e,t)=>{r[e]=t};return kr(e,xr).forEach((e=>n(e,void 0))),{matched:e.some((e=>Or(e,t,n))),selections:r}},getSelectionKeys:()=>kr(e,xr),matcherType:"or"})})}function Zr(e){return{[vr]:()=>({match:t=>({matched:Boolean(e(t))})})}}function Rr(...e){const t="string"==typeof e[0]?e[0]:void 0,r=2===e.length?e[1]:"string"==typeof e[0]?void 0:e[0];return Sr({[vr]:()=>({match:e=>{let n={[null!=t?t:_r]:e};return{matched:void 0===r||Or(r,e,((e,t)=>{n[e]=t})),selections:n}},getSelectionKeys:()=>[null!=t?t:_r].concat(void 0===r?[]:xr(r))})})}function zr(e){return"number"==typeof e}function Ir(e){return"string"==typeof e}function Ar(e){return"bigint"==typeof e}const Mr=Sr(Zr((function(e){return!0}))),Dr=Mr,$r=e=>Object.assign(Sr(e),{startsWith:t=>{return $r(Cr(e,(r=t,Zr((e=>Ir(e)&&e.startsWith(r))))));var r},endsWith:t=>{return $r(Cr(e,(r=t,Zr((e=>Ir(e)&&e.endsWith(r))))));var r},minLength:t=>$r(Cr(e,(e=>Zr((t=>Ir(t)&&t.length>=e)))(t))),length:t=>$r(Cr(e,(e=>Zr((t=>Ir(t)&&t.length===e)))(t))),maxLength:t=>$r(Cr(e,(e=>Zr((t=>Ir(t)&&t.length<=e)))(t))),includes:t=>{return $r(Cr(e,(r=t,Zr((e=>Ir(e)&&e.includes(r))))));var r},regex:t=>{return $r(Cr(e,(r=t,Zr((e=>Ir(e)&&Boolean(e.match(r)))))));var r}}),Lr=$r(Zr(Ir)),Fr=e=>Object.assign(Sr(e),{between:(t,r)=>Fr(Cr(e,((e,t)=>Zr((r=>zr(r)&&e<=r&&t>=r)))(t,r))),lt:t=>Fr(Cr(e,(e=>Zr((t=>zr(t)&&t<e)))(t))),gt:t=>Fr(Cr(e,(e=>Zr((t=>zr(t)&&t>e)))(t))),lte:t=>Fr(Cr(e,(e=>Zr((t=>zr(t)&&t<=e)))(t))),gte:t=>Fr(Cr(e,(e=>Zr((t=>zr(t)&&t>=e)))(t))),int:()=>Fr(Cr(e,Zr((e=>zr(e)&&Number.isInteger(e))))),finite:()=>Fr(Cr(e,Zr((e=>zr(e)&&Number.isFinite(e))))),positive:()=>Fr(Cr(e,Zr((e=>zr(e)&&e>0)))),negative:()=>Fr(Cr(e,Zr((e=>zr(e)&&e<0))))}),Vr=Fr(Zr(zr)),Wr=e=>Object.assign(Sr(e),{between:(t,r)=>Wr(Cr(e,((e,t)=>Zr((r=>Ar(r)&&e<=r&&t>=r)))(t,r))),lt:t=>Wr(Cr(e,(e=>Zr((t=>Ar(t)&&t<e)))(t))),gt:t=>Wr(Cr(e,(e=>Zr((t=>Ar(t)&&t>e)))(t))),lte:t=>Wr(Cr(e,(e=>Zr((t=>Ar(t)&&t<=e)))(t))),gte:t=>Wr(Cr(e,(e=>Zr((t=>Ar(t)&&t>=e)))(t))),positive:()=>Wr(Cr(e,Zr((e=>Ar(e)&&e>0)))),negative:()=>Wr(Cr(e,Zr((e=>Ar(e)&&e<0))))}),qr=Wr(Zr(Ar)),Br=Sr(Zr((function(e){return"boolean"==typeof e}))),Ur=Sr(Zr((function(e){return"symbol"==typeof e}))),Kr=Sr(Zr((function(e){return null==e}))),Hr=Sr(Zr((function(e){return null!=e})));var Jr={__proto__:null,matcher:vr,optional:Er,array:function(...e){return jr({[vr]:()=>({match:t=>{if(!Array.isArray(t))return{matched:!1};if(0===e.length)return{matched:!0};const r=e[0];let n={};if(0===t.length)return xr(r).forEach((e=>{n[e]=[]})),{matched:!0,selections:n};const a=(e,t)=>{n[e]=(n[e]||[]).concat([t])};return{matched:t.every((e=>Or(r,e,a))),selections:n}},getSelectionKeys:()=>0===e.length?[]:xr(e[0])})})},set:function(...e){return Sr({[vr]:()=>({match:t=>{if(!(t instanceof Set))return{matched:!1};let r={};if(0===t.size)return{matched:!0,selections:r};if(0===e.length)return{matched:!0};const n=(e,t)=>{r[e]=(r[e]||[]).concat([t])},a=e[0];return{matched:Tr(t,(e=>Or(a,e,n))),selections:r}},getSelectionKeys:()=>0===e.length?[]:xr(e[0])})})},map:function(...e){return Sr({[vr]:()=>({match:t=>{if(!(t instanceof Map))return{matched:!1};let r={};if(0===t.size)return{matched:!0,selections:r};const n=(e,t)=>{r[e]=(r[e]||[]).concat([t])};if(0===e.length)return{matched:!0};var a;if(1===e.length)throw new Error(`\`P.map\` wasn't given enough arguments. Expected (key, value), received ${null==(a=e[0])?void 0:a.toString()}`);const[i,s]=e;return{matched:Pr(t,((e,t)=>{const r=Or(i,t,n),a=Or(s,e,n);return r&&a})),selections:r}},getSelectionKeys:()=>0===e.length?[]:[...xr(e[0]),...xr(e[1])]})})},intersection:Cr,union:Nr,not:function(e){return Sr({[vr]:()=>({match:t=>({matched:!Or(e,t,(()=>{}))}),getSelectionKeys:()=>[],matcherType:"not"})})},when:Zr,select:Rr,any:Mr,_:Dr,string:Lr,number:Vr,bigint:qr,boolean:Br,symbol:Ur,nullish:Kr,nonNullable:Hr,instanceOf:function(e){return Sr(Zr(function(e){return t=>t instanceof e}(e)))},shape:function(e){return Sr(Zr(function(...e){if(1===e.length){const[t]=e;return e=>Or(t,e,(()=>{}))}if(2===e.length){const[t,r]=e;return Or(t,r,(()=>{}))}throw new Error(`isMatching wasn't given the right number of arguments: expected 1 or 2, received ${e.length}.`)}(e)))}};class Qr extends Error{constructor(e){let t;try{t=JSON.stringify(e)}catch(r){t=e}super(`Pattern matching error: no pattern matches value ${t}`),this.input=void 0,this.input=e}}const Yr={matched:!1,value:void 0};function Gr(e){return new Xr(e,Yr)}class Xr{constructor(e,t){this.input=void 0,this.state=void 0,this.input=e,this.state=t}with(...e){if(this.state.matched)return this;const t=e[e.length-1],r=[e[0]];let n;3===e.length&&"function"==typeof e[1]?n=e[1]:e.length>2&&r.push(...e.slice(1,e.length-1));let a=!1,i={};const s=(e,t)=>{a=!0,i[e]=t},o=!r.some((e=>Or(e,this.input,s)))||n&&!Boolean(n(this.input))?Yr:{matched:!0,value:t(a?_r in i?i[_r]:i:this.input,this.input)};return new Xr(this.input,o)}when(e,t){if(this.state.matched)return this;const r=Boolean(e(this.input));return new Xr(this.input,r?{matched:!0,value:t(this.input,this.input)}:Yr)}otherwise(e){return this.state.matched?this.state.value:e(this.input)}exhaustive(){if(this.state.matched)return this.state.value;throw new Qr(this.input)}run(){return this.exhaustive()}returnType(){return this}}const en=({name:e,value:t,onRemove:r})=>{const n=(0,p.useStyles2)((e=>t=>{const{color:r,borderColor:n}=(0,p.getTagColorsFromName)(e);return{itemStyle:(0,m.css)({display:"flex",alignItems:"center",height:t.spacing(3),backgroundColor:r,color:t.colors.text.maxContrast,border:`1px solid ${n}`,borderRadius:3,padding:`0 ${t.spacing(.5)}`,marginRight:3,whiteSpace:"nowrap",textShadow:"none",fontWeight:500,fontSize:t.typography.bodySmall.fontSize}),nameStyle:(0,m.css)({marginRight:3}),buttonStyles:(0,m.css)({margin:0,"&:hover::before":{display:"none"}})}})(e)),a=Gr(typeof t).with("string",(()=>`"${t}"`)).with("number",(()=>t)).with("boolean",(()=>t.toString())).with("object",(()=>null===t?"null":`"${JSON.stringify(t)}"`)).otherwise((()=>`"${JSON.stringify(t)}"`));return f().createElement("div",{className:n.itemStyle},f().createElement("span",{className:n.nameStyle},e,"=",a),f().createElement(p.IconButton,{name:"times",size:"lg","aria-label":`Remove ${e}`,onClick:()=>r(e),type:"button",className:n.buttonStyles}))};function tn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function rn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){tn(e,t,r[t])}))}return e}function nn(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t.push.apply(t,r)}return t}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const an=e=>{const{datasource:t,onChange:r,onRunQuery:n,query:a}=e,[i,s]=f().useState();var o;const[l,c]=f().useState(null!==(o=e.payload)&&void 0!==o?o:""),[u,d]=f().useState([]),[h,m]=f().useState(null),[y,v]=f().useState([]),[g,_]=f().useState([]),[b,w]=f().useState(!1),O=f().useCallback((()=>{var e,r;return t.listMetrics(null!==(r=null!==(e=null==i?void 0:i.value)&&void 0!==e?e:a.target)&&void 0!==r?r:"",l).then((e=>{const t=(0,H.find)(e,(e=>e.value===a.target));var r;s(void 0===t?{label:"",value:""}:{label:t.label,value:t.value});const n=yr.array(yr.object({name:yr.string()}).passthrough()).parse(null!==(r=null==t?void 0:t.payloads)&&void 0!==r?r:[]);return v(n),e}),(e=>{throw s({label:"",value:""}),_([]),new Error(e.statusText)}))}),[t,l,null==i?void 0:i.value]),x=f().useCallback((()=>{w(!0),O().then((e=>{_(e)})).finally((()=>{w(!1)}))}),[O,_,w]);f().useEffect((()=>x()),[]),f().useEffect((()=>{if(void 0===(null==i?void 0:i.value)||""===(null==i?void 0:i.value))return;if(null!==h&&(null==i?void 0:i.value)===h.metric&&l===h.payload)return;m({payload:l,metric:i.value.toString()});const e=Object.entries(l).filter((([e])=>!y.some((t=>t.name===e)))).map((([e,t])=>({name:e,value:t})));d(e),r(nn(rn({},a),{payload:l,target:i.value.toString()})),n()}),[l,i]);const k=(e,r,n)=>{c((o=>{let l=rn({},o);var c;return(0,H.isArray)(n)?l[e]=n.map((e=>e.value)).filter((e=>void 0!==e&&e.toString().length>0)):n&&void 0!==n.value&&""!==n.value?l[e]=n.value:delete l[e],r&&(w(!0),t.listMetrics(null!==(c=null==i?void 0:i.value)&&void 0!==c?c:"",rn({},l)).then((e=>{const t=(0,H.find)(e,(e=>e.value===a.target));var r;s(void 0===t?{label:"",value:""}:t),v(null!==(r=null==t?void 0:t.payloads)&&void 0!==r?r:[]),_(e)}),(e=>{throw s({label:"",value:""}),_([]),new Error(e.statusText)})).finally((()=>{w(!1)}))),l}))};return f().createElement(f().Fragment,null,f().createElement(C,null,f().createElement(D,{label:"Metric"},f().createElement(p.Select,{isLoading:b,options:g,placeholder:"Select metric",allowCustomValue:!0,value:i,onOpenMenu:()=>{0===x.length&&x()},onChange:e=>{const t=g.find((t=>t.value===e.value));var r;v(null!==(r=null==t?void 0:t.payloads)&&void 0!==r?r:[]),s(e)}}))),y.length>0&&f().createElement(C,null,f().createElement(D,{label:"Payload",style:{width:"100%"}},f().createElement("div",{style:{display:"flex",flexFlow:"row wrap",gap:16,width:"100%"}},y.map((t=>{switch(t.type){case"select":case"multi-select":return f().createElement(p.InlineField,{key:t.name,style:{display:"inline-flex"}},f().createElement(X,nn(rn({},e),{config:t,value:l[t.name],isMulti:"multi-select"===t.type,onPayloadChange:e=>{k(t.name,t.reloadMetric,e)}})));case"textarea":var r;return f().createElement(p.InlineField,{key:t.name,style:{width:"100%",display:"inline"}},f().createElement("div",{style:{width:"100%",display:"flex"}},f().createElement("label",{className:"gf-form-label"},null!==(r=t.label)&&void 0!==r?r:t.name),f().createElement(Y,{config:t,value:l[t.name],onValueChange:e=>{k(t.name,t.reloadMetric,{value:e})}})));default:var n,a;return f().createElement(p.InlineField,{key:t.name,style:{display:"inline-flex"}},f().createElement(p.Input,{prefix:null!==(n=t.label)&&void 0!==n?n:t.name,width:t.width,onBlur:e=>{k(t.name,t.reloadMetric,{value:e.currentTarget.value})},defaultValue:l[t.name],placeholder:null!==(a=t.placeholder)&&void 0!==a?a:""}))}}))))),u.length>0&&f().createElement(C,null,f().createElement(D,{label:"Unknown payload",tooltip:f().createElement(f().Fragment,null,"Payload options that are set but not defined in the ",f().createElement("code",null,"Metric.payloads"),".")},f().createElement("div",{style:{display:"flex",flexFlow:"row wrap",gap:16,width:"100%"}},u.map(((e,t)=>f().createElement(en,{key:`${e.name}-${t}`,name:e.name,value:e.value,onRemove:()=>{k(e.name,!1,{value:""})}})))))))};function sn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function on(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){sn(e,t,r[t])}))}return e}function ln(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t.push.apply(t,r)}return t}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function cn(e){if(!e)return{};if("string"!=typeof e)return e;try{return JSON.parse(e)}catch(e){return console.error(e),{}}}var un=c(531),dn=c(269);function pn(e){return"function"==typeof e}var hn=function(e,t){return hn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},hn(e,t)};function fn(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}hn(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function mn(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function yn(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,a,i=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(e){a={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}return s}function vn(e,t,r){if(r||2===arguments.length)for(var n,a=0,i=t.length;a<i;a++)!n&&a in t||(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var gn,_n,bn=(gn=function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}},(_n=gn((function(e){Error.call(e),e.stack=(new Error).stack}))).prototype=Object.create(Error.prototype),_n.prototype.constructor=_n,_n);function wn(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var On=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,r,n,a;if(!this.closed){this.closed=!0;var i=this._parentage;if(i)if(this._parentage=null,Array.isArray(i))try{for(var s=mn(i),o=s.next();!o.done;o=s.next())o.value.remove(this)}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else i.remove(this);var l=this.initialTeardown;if(pn(l))try{l()}catch(e){a=e instanceof bn?e.errors:[e]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var u=mn(c),d=u.next();!d.done;d=u.next()){var p=d.value;try{xn(p)}catch(e){a=null!=a?a:[],e instanceof bn?a=vn(vn([],yn(a)),yn(e.errors)):a.push(e)}}}catch(e){r={error:e}}finally{try{d&&!d.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}}if(a)throw new bn(a)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)xn(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(r=this._finalizers)&&void 0!==r?r:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&wn(t,e)},e.prototype.remove=function(t){var r=this._finalizers;r&&wn(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}();function xn(e){pn(e)?e():e.unsubscribe()}On.EMPTY;var kn=null,Sn=null,jn=!1,En=!1,Tn={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var a=Tn.delegate;return(null==a?void 0:a.setTimeout)?a.setTimeout.apply(a,vn([e,t],yn(r))):setTimeout.apply(void 0,vn([e,t],yn(r)))},clearTimeout:function(e){var t=Tn.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function Pn(){}var Cn=Nn("C",void 0,void 0);function Nn(e,t,r){return{kind:e,value:t,error:r}}var Zn=function(e){function t(t){var r,n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,((r=t)instanceof On||r&&"closed"in r&&pn(r.remove)&&pn(r.add)&&pn(r.unsubscribe))&&t.add(n)):n.destination=$n,n}return fn(t,e),t.create=function(e,t,r){return new An(e,t,r)},t.prototype.next=function(e){this.isStopped?Dn(function(e){return Nn("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?Dn(Nn("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?Dn(Cn,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(On),Rn=Function.prototype.bind;function zn(e,t){return Rn.call(e,t)}var In=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){Mn(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){Mn(e)}else Mn(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){Mn(e)}},e}(),An=function(e){function t(t,r,n){var a,i,s=e.call(this)||this;return pn(t)||!t?a={next:null!=t?t:void 0,error:null!=r?r:void 0,complete:null!=n?n:void 0}:s&&En?((i=Object.create(t)).unsubscribe=function(){return s.unsubscribe()},a={next:t.next&&zn(t.next,i),error:t.error&&zn(t.error,i),complete:t.complete&&zn(t.complete,i)}):a=t,s.destination=new In(a),s}return fn(t,e),t}(Zn);function Mn(e){jn||function(e){Tn.setTimeout((function(){if(!kn)throw e;kn(e)}))}(e)}function Dn(e,t){var r=Sn;r&&Tn.setTimeout((function(){return r(e,t)}))}var $n={closed:!0,next:Pn,error:function(e){throw e},complete:Pn},Ln=function(e){function t(t,r,n,a,i,s){var o=e.call(this,t)||this;return o.onFinalize=i,o.shouldUnsubscribe=s,o._next=r?function(e){try{r(e)}catch(e){t.error(e)}}:e.prototype._next,o._error=a?function(e){try{a(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,o._complete=n?function(){try{n()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,o}return fn(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(Zn);function Fn(e,t){return r=function(r,n){var a=0;r.subscribe(new Ln(n,(function(r){n.next(e.call(t,r,a++))}),void 0,void 0,void 0))},function(e){if(function(e){return pn(null==e?void 0:e.lift)}(e))return e.lift((function(e){try{return r(e,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")};var r}class Vn{transformMetricFindResponse(e){const t=(0,d.toDataFrame)(e.data),r=[],n=t.fields.find((e=>"__text"===e.name)),a=t.fields.find((e=>"__value"===e.name));if(n&&a)for(let e=0;e<n.values.length;e++)r.push({text:""+n.values[e],value:""+a.values[e]});else r.push(...t.fields.flatMap((e=>e.values)).map((e=>({text:e}))));return Array.from(new Set(r.map((e=>e.text)))).map((e=>{var t;return{text:e,value:null===(t=r.find((t=>t.text===e)))||void 0===t?void 0:t.value}}))}}function Wn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function qn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Wn(e,t,r[t])}))}return e}function Bn(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t.push.apply(t,r)}return t}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Un=({onChange:e,query:t,datasource:r,range:n})=>{const[a,i]=(0,h.useState)(t),s=()=>{e(a)};return f().createElement(f().Fragment,null,f().createElement(p.InlineFieldRow,null,f().createElement(p.InlineField,{label:"Query",invalid:(e=>{if("json"===e.format){const t=(0,un.getTemplateSrv)().replace(e.query,void 0,"json");try{JSON.parse(t)}catch(e){if(e instanceof Error&&"SyntaxError"===e.name)return!0;throw e}}return!1})(a),grow:!0},f().createElement(p.Input,{name:"query",onBlur:s,onChange:e=>i(Bn(qn({},a),{query:e.currentTarget.value})),value:a.query})),f().createElement(p.InlineField,{labelWidth:14,label:"Raw JSON",tooltip:"When enabled, the query string is parsed as a JSON object. Otherwise when disabled, the query string is placed into a 'target' key to create a JSON object."},f().createElement(p.InlineSwitch,{name:"format",onBlur:s,onChange:e=>i(Bn(qn({},a),{format:e.currentTarget.checked?"json":"string"})),value:(o=a.format,"json"===o)}))));var o},Kn=(e,t)=>(t.credentials=e.withCredentials?"include":"same-origin",t.headers=e.headers,(0,un.getBackendSrv)().fetch(t));function Hn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Jn{process(e=(0,d.getDefaultTimeRange)()){return(0,dn.lastValueFrom)(Kn(this.datasource,{url:`${this.datasource.url}/variable`,data:{payload:this.query,range:e},method:"POST"}).pipe(Fn((e=>this.responseParser.transformMetricFindResponse(e)))))}constructor(e,t){Hn(this,"datasource",void 0),Hn(this,"query",void 0),Hn(this,"range",void 0),Hn(this,"responseParser",void 0),this.datasource=e,this.query=t,this.datasource=e,this.query=t,this.range=(0,d.getDefaultTimeRange)(),this.responseParser=new Vn}}function Qn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Yn extends d.CustomVariableSupport{query(e){const t=(e.targets[0],e.targets[0]);if(!t)return(0,dn.of)({data:[]});const r=(i=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Qn(e,t,r[t])}))}return e}({},e.scopedVars),s=null!=(s={__interval:{text:this.datasource.interval,value:this.datasource.interval},__interval_ms:void 0===this.datasource.interval?void 0:{text:d.rangeUtil.intervalToMs(this.datasource.interval),value:d.rangeUtil.intervalToMs(this.datasource.interval)}})?s:{},Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(s)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t.push.apply(t,r)}return t}(Object(s)).forEach((function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(s,e))})),i),n="json"===t.format?JSON.parse(this.templateSrv.replace(t.query,r,"json")):{target:this.templateSrv.replace(t.query,r,"regex")},a=new Jn(this.datasource,n);var i,s;return(0,dn.from)(a.process(e.range)).pipe(Fn((e=>({data:e}))))}constructor(e,t=(0,un.getTemplateSrv)()){super(),Qn(this,"datasource",void 0),Qn(this,"templateSrv",void 0),Qn(this,"editor",void 0),this.datasource=e,this.templateSrv=t,this.editor=Un}}function Gn(e,t,r,n,a,i,s){try{var o=e[i](s),l=o.value}catch(e){return void r(e)}o.done?t(l):Promise.resolve(l).then(n,a)}function Xn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ea(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Xn(e,t,r[t])}))}return e}function ta(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t.push.apply(t,r)}return t}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}class ra extends d.DataSourceApi{filterQuery(e){return!e.hide}query(e){const t=this.processTargets(e);return 0===t.targets.length?Promise.resolve({data:[]}):(e.scopedVars=ea({},this.getVariables(),e.scopedVars),(0,dn.lastValueFrom)(Kn(this,{url:`${this.url}/query`,data:t,method:"POST"}).pipe(Fn((e=>(e.data=e.data.map(d.toDataFrame),e))))))}testDatasource(){var e,t=this;return(e=function*(){const e="Data source is not working";try{const r=yield(0,dn.lastValueFrom)(Kn(t,{url:t.url,method:"GET"}).pipe(Fn((e=>e))));return 200===r.status?{status:"success",message:"Data source is working",title:"Success"}:{message:r.statusText?r.statusText:e,status:"error",title:"Error"}}catch(t){var r,n;if("string"==typeof t)return{status:"error",message:t};let i=t;var a;let s=null!==(a=i.statusText)&&void 0!==a?a:e;return void 0!==(null===(n=i.data)||void 0===n||null===(r=n.error)||void 0===r?void 0:r.code)&&(s+=`: ${i.data.error.code}. ${i.data.error.message}`),{status:"error",message:s,title:"Error"}}},function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function s(e){Gn(i,n,a,s,o,"next",e)}function o(e){Gn(i,n,a,s,o,"throw",e)}s(void 0)}))})()}metricFindQuery(e,t){const r="json"===e.format?JSON.parse((0,un.getTemplateSrv)().replace(e.query,void 0,"json")):{target:(0,un.getTemplateSrv)().replace(e.query,void 0,"regex")};return new Jn(this,r).process(null==t?void 0:t.range)}listMetricPayloadOptions(e,t,r){return(0,dn.lastValueFrom)(Kn(this,{url:`${this.url}/metric-payload-options`,data:{metric:t,payload:this.processPayload(r,"builder",void 0),name:e},method:"POST"}).pipe(Fn((e=>(0,H.isArray)(e.data)?e.data.map((e=>ta(ea({},e),{label:e.label?e.label:e.value}))):[]))))}listMetrics(e,t){return(0,dn.lastValueFrom)(Kn(this,{url:`${this.url}/metrics`,data:{metric:e.toString()?(0,un.getTemplateSrv)().replace(e.toString(),void 0,"regex"):void 0,payload:t?this.processPayload(t,"builder",void 0):void 0},method:"POST"}).pipe(Fn((e=>(0,H.isArray)(e.data)?e.data.map((e=>{return"string"==typeof e?{value:e,label:e,payloads:[]}:ta(ea({},e),{payloads:(null!==(t=e.payloads)&&void 0!==t?t:[]).map((e=>{var t;return ta(ea({},e),{label:null!==(t=e.label)&&void 0!==t?t:e.name})})),label:null!==(r=e.label)&&void 0!==r?r:e.value});var t,r})):[]))))}getTagKeys(e){return(0,dn.lastValueFrom)(Kn(this,{url:`${this.url}/tag-keys`,method:"POST",data:e}).pipe(Fn((e=>e.data))))}getTagValues(e){return(0,dn.lastValueFrom)(Kn(this,{url:`${this.url}/tag-values`,method:"POST",data:e}).pipe(Fn((e=>e.data))))}mapToTextValue(e){return e.data.map(((e,t)=>e&&e.text&&e.value?{text:e.text,value:e.value}:(0,H.isObject)(e)?{text:e,value:t}:{text:e,value:e}))}processPayload(e,t,r){try{if("string"==typeof e&&"builder"!==t)return""!==e.trim()?JSON.parse(e.replace((0,un.getTemplateSrv)().regex,(e=>this.cleanMatch(e,{scopedVars:r})))):{};{const t="string"==typeof e?JSON.parse(e):ea({},e);for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)){const n=t[e];(0,H.isArray)(n)?t[e]=n.map((e=>(0,un.getTemplateSrv)().replace(e.toString(),r,"regex"))):t[e]=(0,un.getTemplateSrv)().replace(t[e].toString(),r,"regex")}return t}}catch(e){return{}}}processTarget(e,t){const r=ea({},e);var n;return r.payload=this.processPayload(null!==(n=r.payload)&&void 0!==n?n:"",r.editorMode,t),"string"==typeof r.target&&(r.target=(0,un.getTemplateSrv)().replace(r.target.toString(),t,"regex")),r}processTargets(e){return e.targets=e.targets.filter((e=>void 0!==e.target)).map((t=>this.processTarget(t,e.scopedVars))),e}cleanMatch(e,t){const r=(0,un.getTemplateSrv)().replace(e,t.scopedVars,"json");return'"'===r[0]&&'"'===r[r.length-1]?JSON.parse(r):r}getVariables(){const e={};return Object.values((0,un.getTemplateSrv)().getVariables()).forEach((t=>{if("adhoc"===t.type)return;if("system"===t.type)return;const r=Gr(t).with({type:Jr.union("custom","query")},(e=>(e=>{let t=e.current.value;return("$__all"===t||(0,H.isEqual)(t,["$__all"]))&&(t=null===e.allValue||""===e.allValue||void 0===e.allValue?e.options.slice(1).map((t=>{if("string"!=typeof t.value){const r=new Error("Variable option value is not a string");throw console.error(r.message,t,e),r}return t.value})):e.allValue),t})(e))).with({type:Jr.union("constant","datasource","groupby","interval","textbox")},(e=>e.current.value)).exhaustive();void 0!==r&&(e[t.id]={selected:!1,text:t.current.text,value:r})})),e}constructor(e,t=(0,un.getTemplateSrv)()){var r,n;super(e),Xn(this,"templateSrv",void 0),Xn(this,"url",void 0),Xn(this,"withCredentials",void 0),Xn(this,"headers",void 0),Xn(this,"responseParser",void 0),Xn(this,"defaultEditorMode",void 0),Xn(this,"annotations",void 0),this.templateSrv=t,this.annotations={},this.responseParser=new Vn,this.defaultEditorMode=null!==(n=null===(r=e.jsonData)||void 0===r?void 0:r.defaultEditorMode)&&void 0!==n?n:"code",this.url=void 0===e.url?"":e.url,this.variables=new Yn(this,this.templateSrv),this.withCredentials=void 0!==e.withCredentials,this.headers={"Content-Type":"application/json"},"string"==typeof e.basicAuth&&e.basicAuth.length>0&&(this.headers.Authorization=e.basicAuth)}}const na=new d.DataSourcePlugin(ra).setConfigEditor((({options:e,onOptionsChange:t})=>{var r;return f().createElement(f().Fragment,null,f().createElement(p.DataSourceHttpSettings,{defaultUrl:"http://localhost:8080",dataSourceConfig:e,showAccessOptions:!0,onChange:t}),f().createElement("h3",{className:"page-heading"},"Other"),f().createElement("div",{className:"gf-form-group"},f().createElement("div",{className:"gf-form-inline"},f().createElement("div",{className:"gf-form"},f().createElement(p.Field,{label:"Default edit mode"},f().createElement(g,{size:"md",mode:null!==(r=e.jsonData.defaultEditorMode)&&void 0!==r?r:"code",onChange:r=>{t(w(b({},e),{jsonData:w(b({},e.jsonData),{defaultEditorMode:r})}))}}))))))})).setQueryEditor((e=>{const{onChange:t,query:r,datasource:n}=e,{defaultEditorMode:a}=n,i=r.editorMode,[s,o]=f().useState(!1);f().useEffect((()=>{var e;t(ln(on({},r),{editorMode:null!==(e=r.editorMode)&&void 0!==e?e:a}))}),[]);const l=(0,h.useCallback)((e=>{t(ln(on({},r),{editorMode:e}))}),[t,r]);return f().createElement(f().Fragment,null,f().createElement(O,null,f().createElement(p.InlineField,{label:"Mode"},f().createElement(g,{size:"md",mode:i,onChange:l})),f().createElement(p.InlineField,{label:"Raw query"},f().createElement(p.InlineSwitch,{sizes:"md",label:"Raw query",value:s,onChange:e=>o(e.currentTarget.checked)}))),f().createElement(P,null,"code"===(null!=i?i:a)&&f().createElement(Q,ln(on({},e),{payload:(c=r.payload,"string"==typeof c?c:c?JSON.stringify(c,void 0,2):"")})),"builder"===(null!=i?i:a)&&f().createElement(an,ln(on({},e),{payload:cn(r.payload)}))),s&&f().createElement(C,null,f().createElement(D,{label:"Raw query",width:"100%",style:{width:"100%"}},f().createElement(K,{disableHeight:!0},(({width:e})=>f().createElement("div",{style:{width:e+"px"}},f().createElement(p.CodeEditor,{width:"100%",height:"200px",readOnly:!0,value:JSON.stringify(n.processTarget(r),void 0,2),onBlur:()=>{},language:"json"})))))));var c}));return u})()));
//# sourceMappingURL=module.js.map